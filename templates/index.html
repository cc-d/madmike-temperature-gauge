<!DOCTYPE html>
<head>
	<title>Temperature Data</title>
	<script type="text/javascript" src="{{ url_for('static', filename='jquery-3.3.1.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='plotly-latest.min.js') }}"></script>

<style>
#full {
	position: absolute;
	color: black;
	height: 100%;
	width: 98%;
}
#fullgraph {
	position: inline-block;
	color: green;
	margin-top: 100px;
	height: 100%;
	width: 100%;
}
#closeicon {
	height: 100%;
	width: 100%;
	font-size: 80px;
}
#closegraph {
	position: inline-block;
	float: right;
	width: 50px;
	height: 50px;
}
#title{
	font-size: 40px;
	color: yellow;
	text-align: center;
}
body{
	background-color: #606060;
	font-family: arial;
}
h1{
	color: #f6f6f6;
}
#squarecontainer{
  margin: 0 auto;
  width: 100%;
  height: 100%;
}
#topr{
  width: 100%;
  height: 100%;
  display: inline-block;
  text-align: center;
}
.square{
  margin: 3px;
  width: 280px;
  height: 280px;
  background-color: green;
  display: inline-block;
}
#myDiv0{
	display: inline-block;
}
#myDiv1{
	display: inline-block;
}
#myDiv2{
	display: inline-block;
}
#myDiv3{
	display: inline-block;
}
</style>
</head>

<body>
<div id="full" style="display:none;">
	<div id="closegraph">
		<a id="closeicon" href="javascript:showcontent()">x</a>
	</div>
	<div id="fullgraph">
	</div>
</div>


<div style='margin: 0 auto; text-align: center'>
	<div style='display: inline-block;'>
		<div style='display: inline-block;'>
			<h1>Current Time: <br>Current Date: </h1>
		</div>
		<div id='ctime' style='display: inline-block;'></div>
	</div>
	<div style='display: inline-block;'>
		<div style='display: inline-block; padding-left: 50px;'>
			<h1>Current Temp:</h1>
		</div>
		<div id='ctemp' style='display: inline-block; font-size: 30px;'></div>
	</div>
</div>
<div id='hlow' style='text-align: center; margin: 0 auto;'>
</div>
<div id='squarecontainer'>
   <div id="topr">
     <div id='myDiv0' class="square" onclick="gensingle(0)">
     </div>
     
     <div id='myDiv1' class="square" onclick="gensingle(1)">
     </div>
   
     <div id='myDiv2' class="square" onclick="gensingle(2)">
     </div>
     
     <div id='myDiv3' class="square" onclick="gensingle(3)">
     </div>
   </div>
</div>
<div id='myDiv4' style='height:300px; width: 90%; margin: 0 auto;' onclick="gensingle(4)">
</div>


<script>
function refreshData() {
var req = new XMLHttpRequest();
req.overrideMimeType("application/json");
req.open('GET', 'api/current_temperature', true);
req.send(null);
req.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
	jdata = JSON.parse(req.responseText);
document.getElementById('ctemp').innerHTML = '<h1 style="padding-left: 20px; color:LightGreen;">' + jdata['f'] + ' F' + '</h1>';
};

var ctime = new Date();
var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
var days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

//<h1>Current Date<br>Time</h1>
document.getElementById('ctime').innerHTML = '<h1 style="padding-left: 20px; color:LightGreen;">' + ctime.getHours() + ':' + ctime.getMinutes() + '</br>' + months[ctime.getMonth()] + ' ' + ctime.getDay() + ', ' + ctime.getFullYear() + '</h1>';


};
    //x = 60 * 15;  // Once every 15 minutes
    x = 15; // Once every 15 seconds
    setTimeout(refreshData, x*1000);
};
refreshData();

function hlow() {
var req = new XMLHttpRequest();
req.overrideMimeType("application/json");
req.open('GET', 'api/get_high_low', true);
req.send(null);
req.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
        jdata = JSON.parse(req.responseText);
	var high = '';
	var low = '';
	//console.log(jdata)
	for (i=0;i<2;i++){
		if (jdata[i]['type'] == 'high') {
			high = jdata[i]['f'];
		}
		if (jdata[i]['type'] == 'low') {
			low = jdata[i]['f']
		}
	}
	//console.log(high);
	//console.log(low);
    low = '<p style="display: inline-block; color: blue;">' + low + ' F' + '</p>';
    high = '<p style="display: inline-block; color: red;">' + high + ' F' + '</p>';
	document.getElementById('hlow').innerHTML = '<div style="display: inline-block;"><h1 id="ht">High Today: ' + high  + '</h1></div>';
	document.getElementById('hlow').innerHTML += '<div style="display: inline-block; padding-left: 80px;"><h1 id="lt">Low Today: ' + low  + '</h1></div>';
	
};
};
};
hlow();

function gendefs() {
	var dayago = (Date.now() - (60 * 60 * 24 * 1000));
	var weekago = (Date.now() - (60 * 60 * 24 * 7 * 1000));
	var monthago = (Date.now() - (60 * 60 * 24 * 7 * 4 * 1000));
	var yearago = (Date.now() - (60 * 60 * 24 * 7 * 4 * 12 * 1000))
	
	var ranges = ['?time1=' + String(Date.now()) + '&time2=' + String(dayago), 
			'?time1=' + String(Date.now()) + '&time2=' + String(weekago), 
			'?time1=' + String(Date.now()) + '&time2=' + String(monthago),
			'?time1=' + String(Date.now()) + '&time2=' + String(yearago), ''];
	var layouts = ['Day','Week','Month','Year','All Time'];
	
	for(iz=0;iz<=4;iz++){
	(function(iz) {
	var req = new XMLHttpRequest();
	req.overrideMimeType("application/json");
	//console.log('api/temperature_history' + ranges[iz]);
	req.open('GET', 'api/temperature_history' + ranges[iz], true);
	req.send(null);
	req.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
		times = []
		temps = []
		jdata = JSON.parse(req.responseText);
		//console.log(jdata);
		//console.log(jdata[0]);
		l = (jdata.length);
		for (i=0; i<l; i++) { //i<jdata.length; i++) {
			rec = jdata[i];
			//console.log(rec['f'], rec['time']);
			temps.push(rec['f']);
			times.push(rec['time']);
		}
		var data = [{
			//x: ['2013-10-04 22:23:00', '2013-11-04 22:23:00', '2013-12-04 22:23:00'],
			//y: [1, 3, 6],
			x: times.sort(),
			y: temps,
			type: 'scatter'
		}];
		var layout = {
	  title: layouts[iz],
	};
		Plotly.newPlot('myDiv' + String(iz), data, layout);
	};
	};
	})(iz);
	}
}
gendefs();

function gensingle(targi) {
	$('#actualcontent').hide()
	$('#full').show()
	var dayago = (Date.now() - (60 * 60 * 24 * 1000));
	var weekago = (Date.now() - (60 * 60 * 24 * 7 * 1000));
	var monthago = (Date.now() - (60 * 60 * 24 * 7 * 4 * 1000));
	var yearago = (Date.now() - (60 * 60 * 24 * 7 * 4 * 12 * 1000))
	
	var ranges = ['?time1=' + String(Date.now()) + '&time2=' + String(dayago), 
			'?time1=' + String(Date.now()) + '&time2=' + String(weekago), 
			'?time1=' + String(Date.now()) + '&time2=' + String(monthago),
			'?time1=' + String(Date.now()) + '&time2=' + String(yearago), ''];
	var layouts = ['Day','Week','Month','Year','All Time'];
	
	for(iz=targi;iz<=targi;iz++){
	(function(iz) {
	var req = new XMLHttpRequest();
	req.overrideMimeType("application/json");
	//console.log('api/temperature_history' + ranges[iz]);
	req.open('GET', 'api/temperature_history' + ranges[iz], true);
	req.send(null);
	req.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
		times = []
		temps = []
		jdata = JSON.parse(req.responseText);
		//console.log(jdata);
		//console.log(jdata[0]);
		l = (jdata.length);
		for (i=0; i<l; i++) { //i<jdata.length; i++) {
			rec = jdata[i];
			//console.log(rec['f'], rec['time']);
			temps.push(rec['f']);
			times.push(rec['time']);
		}
		var data = [{
			//x: ['2013-10-04 22:23:00', '2013-11-04 22:23:00', '2013-12-04 22:23:00'],
			//y: [1, 3, 6],
			x: times.sort(),
			y: temps,
			type: 'scatter'
		}];
		var layout = {
	  title: layouts[iz],
	};
		Plotly.newPlot('fullgraph', data, layout);
	};
	};
	})(iz);
	}
}

function showcontent(){
	$('#actualcontent').show()
	$('#full').hide()
}

</script>

</body>
</html>
